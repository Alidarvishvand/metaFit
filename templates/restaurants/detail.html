{% extends 'base.html' %}

{% block title %}{{ restaurant.name }}{% endblock %}

{% block extra_css %}
<style>
    .back-link {
        margin-bottom: 25px;
        display: inline-block;
        background: #95a5a6;
    }
    
    .back-link:hover {
        background: #7f8c8d;
    }
    
    .restaurant-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e9ecef;
    }
    
    .restaurant-header h1 {
        color: #2c3e50;
        font-size: 2.5em;
        margin-bottom: 15px;
        font-weight: 700;
    }
    
    .restaurant-info {
        margin-bottom: 30px;
    }
    
    .info-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 1px solid #e9ecef;
    }
    
    .info-section h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.3em;
        font-weight: 600;
    }
    
    .info-section p, .info-section div {
        color: #555;
        line-height: 1.8;
        font-size: 1.1em;
    }
    
    .phone-list {
        list-style: none;
        padding: 0;
    }
    
    .phone-list li {
        background: white;
        padding: 10px 15px;
        margin: 8px 0;
        border-radius: 8px;
        color: #3498db;
        font-weight: 500;
        font-size: 1.1em;
        border: 1px solid #e9ecef;
    }
    
    .image-gallery {
        margin-top: 30px;
    }
    
    .image-gallery h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.5em;
        text-align: center;
        font-weight: 600;
    }
    
    .gallery-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .gallery-main {
        width: 100%;
        height: 500px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        margin-bottom: 15px;
        position: relative;
    }
    
    .gallery-main img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
    
    .gallery-thumbnails {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding: 10px 0;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
    
    .gallery-thumbnails::-webkit-scrollbar {
        height: 8px;
    }
    
    .gallery-thumbnails::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .gallery-thumbnails::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 10px;
    }
    
    .gallery-thumbnails::-webkit-scrollbar-thumb:hover {
        background: #764ba2;
    }
    
    .thumbnail {
        min-width: 120px;
        height: 120px;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.3s, transform 0.3s;
        border: 3px solid transparent;
    }
    
    .thumbnail:hover {
        opacity: 1;
        transform: scale(1.05);
    }
    
    .thumbnail.active {
        opacity: 1;
        border-color: #667eea;
    }
    
    .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .no-images {
        text-align: center;
        padding: 60px 20px;
        background: #f8f9fa;
        border-radius: 15px;
        color: #6c757d;
        border: 1px solid #e9ecef;
    }
    
    .no-images h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
        color: #2c3e50;
    }
    
    .rating-section {
        text-align: center;
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 15px;
        border: 1px solid #e9ecef;
    }
    
    .rating-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin: 15px 0;
    }
    
    .stars {
        font-size: 2em;
        color: #ffd700;
    }
    
    .rating-text {
        font-size: 1.3em;
        color: #2c3e50;
        font-weight: bold;
    }
    
    .rating-count {
        color: #666;
        font-size: 0.9em;
    }
    
    .comment-section {
        margin-top: 40px;
    }
    
    .comment-form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        border: 1px solid #e9ecef;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .comment-form h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.2em;
        font-weight: 600;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 6px;
        color: #555;
        font-weight: 500;
        font-size: 0.9em;
    }
    
    .form-input, .form-textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        font-family: inherit;
        transition: border-color 0.3s;
    }
    
    .form-input:focus, .form-textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .rating-input-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin: 12px 0;
    }
    
    .rating-input-group label.rating-label {
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        padding: 8px 12px;
        background: white;
        border: 2px solid #ddd;
        border-radius: 8px;
        transition: all 0.3s;
        font-size: 0.9em;
    }
    
    .rating-input-group label.rating-label:hover {
        border-color: #667eea;
        background: #f0f0ff;
    }
    
    .rating-input-group input[type="radio"] {
        display: none;
    }
    
    .rating-input-group input[type="radio"]:checked + .star-icon {
        color: #ffd700;
    }
    
    .rating-input-group input[type="radio"]:checked ~ .rating-label,
    .rating-input-group label.rating-label:has(input[type="radio"]:checked) {
        border-color: #3498db;
        background: #ebf5fb;
    }
    
    .rating-input-group label:hover {
        border-color: #3498db;
        background: #ebf5fb;
    }
    
    .star-icon {
        color: #ddd;
        font-size: 1.3em;
        transition: color 0.3s;
    }
    
    .rating-text {
        font-size: 0.95em;
    }
    
    .comments-list {
        margin-top: 25px;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .comments-list h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.2em;
        font-weight: 600;
    }
    
    .comment-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-right: 3px solid #3498db;
    }
    
    .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .comment-author {
        font-weight: bold;
        color: #2c3e50;
        font-size: 1em;
    }
    
    .comment-date {
        color: #999;
        font-size: 0.85em;
    }
    
    .comment-rating {
        color: #ffd700;
        font-size: 1.1em;
        margin: 8px 0;
    }
    
    .comment-text {
        color: #555;
        line-height: 1.6;
        font-size: 0.9em;
    }
    
    .no-comments {
        text-align: center;
        padding: 40px;
        color: #6c757d;
        background: #f8f9fa;
        border-radius: 15px;
        border: 1px solid #e9ecef;
    }
    
    .messages {
        margin-bottom: 20px;
    }
    
    .message {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>
{% endblock %}

{% block content %}
<a href="{% url 'restaurants:list' %}" class="btn back-link">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>

<div class="restaurant-header">
    <h1>{{ restaurant.name }}</h1>
    {% if avg_rating > 0 %}
    <div class="rating-section">
        <div class="rating-display">
            <div class="stars">
                {% for i in "12345" %}
                    {% if forloop.counter <= avg_rating|floatformat:0|add:"0" %}
                        â˜…
                    {% else %}
                        â˜†
                    {% endif %}
                {% endfor %}
            </div>
            <div>
                <div class="rating-text">{{ avg_rating }} Ø§Ø² 5</div>
                <div class="rating-count">Ø¨Ø± Ø§Ø³Ø§Ø³ {{ total_ratings }} Ø§Ù…ØªÛŒØ§Ø²</div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<div class="restaurant-info">
    <div class="info-section">
        <h3>ğŸ“ Ø¢Ø¯Ø±Ø³</h3>
        <p>{{ restaurant.address }}</p>
    </div>
    
    {% if restaurant.phone_numbers.all %}
    <div class="info-section">
        <h3>ğŸ“ Ø´Ù…Ø§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ø³</h3>
        <ul class="phone-list">
            {% for phone in restaurant.phone_numbers.all %}
                <li>{{ phone.phone }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>

<div class="image-gallery">
    <h3>Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø±Ø³ØªÙˆØ±Ø§Ù†</h3>
    
    {% if restaurant.images.all %}
        <div class="gallery-container">
            <div class="gallery-main">
                <img id="main-image" src="{{ restaurant.images.first.image.url }}" alt="{{ restaurant.name }}">
            </div>
            
            <div class="gallery-thumbnails">
                {% for image in restaurant.images.all %}
                    <div class="thumbnail {% if forloop.first %}active{% endif %}" onclick="changeImage('{{ image.image.url }}', this)">
                        <img src="{{ image.image.url }}" alt="{{ image.description|default:restaurant.name }}">
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="no-images">
            <h3>ğŸ“·</h3>
            <p>Ù‡Ù†ÙˆØ² Ø¹Ú©Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø±Ø³ØªÙˆØ±Ø§Ù† Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
        </div>
    {% endif %}
</div>

{% if restaurant.description %}
<div class="restaurant-info" style="margin-top: 30px;">
    <div class="info-section">
        <h3>ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª</h3>
        <p>{{ restaurant.description|linebreaks }}</p>
    </div>
</div>
{% endif %}

<!-- Ø¨Ø®Ø´ Ú©Ø§Ù…Ù†Øª Ùˆ Ø±ÛŒØªÛŒÙ†Ú¯ -->
<div class="comment-section">
    <div class="comment-form">
        <h3>ğŸ’¬ Ø«Ø¨Øª Ù†Ø¸Ø± Ùˆ Ø§Ù…ØªÛŒØ§Ø²</h3>
        
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
                {{ form.name }}
                {% if form.name.errors %}
                    <div style="color: red; font-size: 0.9em; margin-top: 5px;">{{ form.name.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.email.id_for_label }}">{{ form.email.label }} (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                {{ form.email }}
                {% if form.email.errors %}
                    <div style="color: red; font-size: 0.9em; margin-top: 5px;">{{ form.email.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.rating.id_for_label }}">{{ form.rating.label }}</label>
                <div class="rating-input-group">
                    {% for choice in form.rating %}
                        <label class="rating-label">
                            {{ choice.tag }}
                            <span class="star-icon">â˜…</span>
                            <span class="rating-text">{{ choice.choice_label }}</span>
                        </label>
                    {% endfor %}
                </div>
                {% if form.rating.errors %}
                    <div style="color: red; font-size: 0.9em; margin-top: 5px;">{{ form.rating.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.comment.id_for_label }}">{{ form.comment.label }}</label>
                {{ form.comment }}
                {% if form.comment.errors %}
                    <div style="color: red; font-size: 0.9em; margin-top: 5px;">{{ form.comment.errors }}</div>
                {% endif %}
            </div>
            
            <button type="submit" class="btn" style="padding: 10px 25px; font-size: 0.95em;">Ø«Ø¨Øª Ù†Ø¸Ø±</button>
        </form>
    </div>
    
    <div class="comments-list">
        <h3>ğŸ“ Ù†Ø¸Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ({{ comments.count }})</h3>
        
        {% if comments %}
            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-header">
                    <div class="comment-author">{{ comment.name }}</div>
                    <div class="comment-date">{{ comment.created_at|date:"Y/m/d H:i" }}</div>
                </div>
                {% if comment.rating %}
                <div class="comment-rating">
                    {% for i in "12345" %}
                        {% if forloop.counter <= comment.rating.rating %}
                            â˜…
                        {% else %}
                            â˜†
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
                <div class="comment-text">{{ comment.comment }}</div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-comments">
                <p>Ù‡Ù†ÙˆØ² Ù†Ø¸Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§ÙˆÙ„ÛŒÙ† Ù†Ø¸Ø± Ø±Ø§ Ø´Ù…Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function changeImage(imageUrl, thumbnail) {
        // ØªØºÛŒÛŒØ± Ø¹Ú©Ø³ Ø§ØµÙ„ÛŒ
        document.getElementById('main-image').src = imageUrl;
        
        // Ø­Ø°Ù Ú©Ù„Ø§Ø³ active Ø§Ø² ØªÙ…Ø§Ù… thumbnail Ù‡Ø§
        document.querySelectorAll('.thumbnail').forEach(function(thumb) {
            thumb.classList.remove('active');
        });
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ active Ø¨Ù‡ thumbnail Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        thumbnail.classList.add('active');
        
        // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ thumbnail Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        thumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }
</script>
{% endblock %}

